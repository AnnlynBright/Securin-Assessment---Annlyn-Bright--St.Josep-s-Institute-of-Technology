document.addEventListener("DOMContentLoaded", function() {
    const apiUrl = "https://services.nvd.nist.gov/rest/json/cves/2.0";
    const cveDetailsDiv = document.getElementById("cve-details");
    const backButton = document.getElementById("back-button");

    const urlParams = new URLSearchParams(window.location.search);
    const cveId = urlParams.get('cveId');

    if (!cveId) {
        cveDetailsDiv.innerHTML = "<p>Invalid CVE ID.</p>";
        return;
    }

    function fetchCveDetails(id) {
        const url = `${apiUrl}?cveId=${id}`;

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.vulnerabilities && data.vulnerabilities.length > 0) {
                    displayCveDetails(data.vulnerabilities[0].cve);
                } else {
                    cveDetailsDiv.innerHTML = "<p>No details available for this CVE ID.</p>";
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                cveDetailsDiv.innerHTML = "<p>Failed to load CVE details.</p>";
            });
    }

    function displayCveDetails(cve) {
        console.log(cve);
        const description = cve.descriptions[0]?.value || "No description available";
        const baseScoreV2 = cve.metrics.cvssMetricV2 ? cve.metrics.cvssMetricV2[0].cvssData.baseScore : "N/A";
        const baseScoreV3 = cve.metrics.cvssMetricV3 ? cve.metrics.cvssMetricV3[0].cvssData.baseScore : "N/A";
        const severityV2 = cve.metrics.cvssMetricV2 ? cve.metrics.cvssMetricV2[0].baseSeverity : "N/A";
        const severityV3 = cve.metrics.cvssMetricV3 ? cve.metrics.cvssMetricV3[0].baseSeverity : "N/A";
        const cpe = cve.configurations?.nodes?.map(node => node.cpeMatch.map(match => match.criteria)).flat().join(", ") || "N/A";

        cveDetailsDiv.innerHTML = `
            <h2>${cve.id}</h2>
            <p><strong>Description:</strong> ${description}</p>
            <p><strong>CVSS v2 Base Score:</strong> ${baseScoreV2}</p>
            <p><strong>CVSS v3 Base Score:</strong> ${baseScoreV3}</p>
            <p><strong>Severity v2:</strong> ${severityV2}</p>
            <p><strong>Severity v3:</strong> ${severityV3}</p>
            <p><strong>CPE:</strong> ${cpe}</p>
        `;
    }

    backButton.addEventListener("click", () => {
        window.history.back();
    });

   
    fetchCveDetails(cveId);
});
